import { Parent, Query, ResolveField, Resolver } from '@nestjs/graphql';
import { QueryBus } from '@nestjs/cqrs';
import { EnabledScenesQuery } from '../queries/impl';
import { Scene } from '../schemas';

@Resolver('Scene')
export class ScenesUserResolver {
  constructor(private readonly queryBus: QueryBus) {}

  @Query('scenes')
  enabled() {
    return this.queryBus.execute(new EnabledScenesQuery());
  }

  @ResolveField('cacheKey')
  fieldCacheKey(@Parent() model: Scene) {
    return `scene:${model.slug}`;
  }

  @ResolveField('timestamp')
  fieldTimestamp(@Parent() model: Scene) {
    return model.updatedAt;
  }
}
